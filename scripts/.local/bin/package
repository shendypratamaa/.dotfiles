#!/bin/bash

set -e

update() {
	echo "Package Update ğŸº..."
	brew update --verbose --force && brew upgrade

	echo "Package Update From Brewfile ğŸï¸..."
	brew bundle -v --file=~/.config/brewfile/Brewfile

	echo "Package Info ğŸ—“ï¸..."
	brew info
}

bundle() {
	echo "Package Bundle ğŸ“¦..."
	brew bundle dump --desc --force --file=~/.config/brewfile/Brewfile
	bat ~/.config/brewfile/Brewfile
}

clean() {
	echo "Package Clean ğŸ¤–..."
	brew cleanup && brew cleanup --prune=all
	brew autoremove
}

leave() {
	echo "Process Complete! ğŸŒŸ..."
	exit
}

help() {
	cat <<-_EOF_
		Homebrew Package Update 0.0.1 ğŸ’

		package [command] :
		-a update homebrew | install package from brewfile | brew cleanup | generate brewfile and preview brewfile
		-b generate brewfile into specified directory and preview brewfile
		-c clean unused brew package / remove old version package / remove cache
		-r --reinstall will reinstall all package
		-h help
	_EOF_
}

# brew upgrade | brew install | brew bundle | brew clean | complete
if [ "$1" == "-a" ]; then
	update
	clean
	bundle
	leave
fi

# brew dump
if [ "$1" == "-b" ]; then
	bundle
	leave
fi

# brew cleanup
if [ "$1" == "-c" ]; then
	clean
	leave
fi

if [ "$1" == "-h" ]; then
	help
	exit
fi

if [ "$1" == "-r" ] || [ "$1" == "--reinstall" ]; then
	echo "Uninstalling Package ğŸŒŠ..."
	brew list --cask | xargs brew uninstall --force
	brew list | xargs brew uninstall --force
	echo "Uninstall Sucessfully ğŸŒŸ..."
	update
	clean
	bundle
	leave
fi

if [ -n "$1" ]; then
	echo "command not found ğŸš“"
	echo "execute package -h for information"
	exit
fi

echo "Homebrew Package Update 0.0.1 ğŸ’"
echo "package -h for information"
