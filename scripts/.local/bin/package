#!/bin/bash

set -e

update() {
	echo "Package Update ðŸº..."
	brew update --verbose --force && brew upgrade

	echo "Package Update From Brewfile ðŸŽžï¸..."
	brew bundle -v --file=~/.config/brewfile/Brewfile

	echo "Package Info ðŸ—“ï¸..."
	brew info
}

info() {
	echo "-----------------------------"
	echo "Package List ðŸ“¦ ==>"
	brew ls --formulae
	echo "-----------------------------"
	echo "Package Cask ðŸ“¦ ==>"
	brew ls --casks
	echo "-----------------------------"
	echo "Package Info ðŸ“¦ ==>"
	brew info
}

bundle() {
	echo "Package Bundle ðŸ“¦..."
	brew bundle dump --desc --force --file=~/.config/brewfile/Brewfile
	bat ~/.config/brewfile/Brewfile
}

clean() {
	echo "Package Clean ðŸ¤–..."
	brew cleanup && brew cleanup --prune=all
	brew autoremove
}

leave() {
	echo "Process Complete! ðŸŒŸ..."
	exit
}

help() {
	cat <<-_EOF_
		Homebrew Package Update 0.0.1 ðŸ’

		package [command] :
		-a update homebrew | install package from brewfile | brew cleanup | generate brewfile and preview brewfile
		-b generate brewfile into specified directory and preview brewfile
		-c clean unused brew package / remove old version package / remove cache
		-i package list
		-r --reinstall will reinstall all package
		-h help
	_EOF_
}

# brew upgrade | brew install | brew bundle | brew clean | complete
if [ "$1" == "-a" ]; then
	update
	clean
	bundle
	leave
fi

# brew dump
if [ "$1" == "-b" ]; then
	bundle
	leave
fi

# brew cleanup
if [ "$1" == "-c" ]; then
	clean
	leave
fi

if [ "$1" == "-h" ]; then
	help
	exit
fi

if [ "$1" == "-r" ] || [ "$1" == "--reinstall" ]; then
	echo "Uninstalling Package ðŸŒŠ..."
	brew list --cask | xargs brew uninstall --force
	brew list | xargs brew uninstall --force
	echo "Uninstall Sucessfully ðŸŒŸ..."
	update
	clean
	bundle
	leave
fi

if [ "$1" == "-i" ]; then
	info
	exit
fi

if [ -n "$1" ]; then
	echo "command not found ðŸ™Š"
	echo "package -h for help ðŸ’"
	exit
fi

echo "Homebrew Package Update 0.0.1 ðŸ“¦"
echo "package -h for help ðŸ’"
